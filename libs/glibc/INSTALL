mkdir $SOURCE_DIRECTORY/glibc-build/old.libs  &&

message "${MESSAGE_COLOR}Copying old libraries${DEFAULT_COLOR}" &&
for file in /lib; do
    if [ -f "$file" ]; then
        cp -a "$file" $SOURCE_DIRECTORY/glibc-build/old.libs
    fi
done &&

message "${MESSAGE_COLOR}Running ldconfig${DEFAULT_COLOR}" &&
ldconfig $SOURCE_DIRECTORY/glibc-build/old.libs &&

message "${MESSAGE_COLOR}Changing ld-linux${DEFAULT_COLOR}" &&
for each in /lib/ld-linux*; do
    if [ -f "$each" ]; then
        LD=$(readlink "$each")
	LDB=${LD##*/}
	ln -sfv $SOURCE_DIRECTORY/glibc-build/old.libs/$LDB "$each"
    fi
done &&

cd $SOURCE_DIRECTORY/glibc-build &&

message "${MESSAGE_COLOR}Removing glibc${DEFAULT_COLOR}" &&
lrm --no-sustain glibc &&

# glibc only installs those if the file differs
for file in ${INSTALL_ROOT}/usr/include/bits/syscall.h \
    ${INSTALL_ROOT}/usr/include/gnu/stubs.h \
    ${INSTALL_ROOT}/usr/include/gnu/stubs-32.h \
    ${INSTALL_ROOT}/usr/include/gnu/stubs-64.h; do
    if [ -f "$file" ]; then
        rm -vf $file
    fi
done &&

make install install_root="${INSTALL_ROOT}"
